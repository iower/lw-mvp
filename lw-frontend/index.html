<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <button>Connect LW</button>
  </br>
  </br>
  <a href="#">GitHub | â˜… 0</a>

  <script>
    if (!("serial" in navigator)) {
      alert("No serial support")
    }

    // document.querySelector('button').addEventListener('click', async () => {
    (async () => {
      const ports = await navigator.serial.getPorts()
      console.log('ports', ports)

      let port

      if (!ports.length) {
        console.warn("No ports")
        return
      } else if (ports.length === 1) {
        port = ports[0]
      } else {
        const filters = [
          { usbVendorId: 0x2341, usbProductId: 0x0043 },
          { usbVendorId: 0x2341, usbProductId: 0x0001 }
        ];
        port = await navigator.serial.requestPort({ filters });
      }

      await port.open({ baudRate: 115200 })

      const { usbVendorId, usbProductId } = port.getInfo();
      console.log(usbVendorId, usbProductId)

      while (port.readable) {
        const textDecoder = new TextDecoderStream();
        const readableStreamClosed = port.readable.pipeTo(textDecoder.writable);
        const reader = textDecoder.readable.getReader();

        try {
          while (true) {
            const { value, done } = await reader.read();
            if (done) {
              reader.releaseLock();
              break;
            }
            console.log(value); // Uint8Array
          }
        } catch (err) {
          console.error(err)
        }
      }
    })()
    // });

    const font = {
      A: [
        ' #',
        '# #',
        '###',
        '# #',
      ],
      B: [
        '##',
        '##',
        '# #',
        '###',
      ],
      C: [
        ' ##',
        '#  ',
        '#  ',
        ' ##',
      ],
      D: [
        '##',
        '# #',
        '# #',
        '##',
      ],
      E: [
        '###',
        '#  ',
        '## ',
        '###',
      ],
      F: [
        '###',
        '#  ',
        '## ',
        '#  ',
      ],
      G: [
        ' ##',
        '#  ',
        '# #',
        ' ##',
      ],
      H: [
        '# #',
        '###',
        '# #',
        '# #',
      ],
      I: [
        '###',
        ' # ',
        ' # ',
        '###',
      ],
      J: [
        ' ##',
        '  #',
        '  #',
        '## ',
      ],
      K: [
        '# #',
        '## ',
        '# #',
        '# #',
      ],
      L: [
        '#  ',
        '#  ',
        '#  ',
        '###',
      ],
      M: [
        ' # # ',
        ' # # ',
        '# # #',
        '# # #',
      ],
      N: [
        '#  #',
        '## #',
        '# ##',
        '#  #',
      ],
      O: [
        ' # ',
        '# #',
        '# #',
        ' #',
      ],
      P: [
        '## ',
        '# #',
        '## ',
        '#  ',
      ],
      Q: [
        '###',
        '# #',
        '###',
        '  #',
      ],
      R: [
        '###',
        '# #',
        '## ',
        '# #',
      ],
      S: [
        ' ##',
        '# ',
        '  #',
        '##',
      ],
      T: [
        '###',
        ' # ',
        ' # ',
        ' # ',
      ],
      U: [
        '#  #',
        '#  #',
        '#  #',
        ' ## ',
      ],
      V: [
        '# #',
        '# #',
        '# #',
        ' # ',
      ],
      W: [
        '# # #',
        '# # #',
        '# # #',
        ' # # ',
      ],
      X: [
        '# #',
        ' # ',
        ' # ',
        '# #',
      ],
      Y: [
        '# #',
        ' # ',
        ' # ',
        ' # ',
      ],
      Z: [
        '###',
        '  #',
        ' # ',
        '###',
      ],
      /*
      A: [
        '',
        '',
        '',
        '',
      ],
      */
    }

    const makeFont = () => {
      let t =
      [
      '#   #  #         ## #   #   #      # #  ##  # ',
      '#      ###  ### # # #  # #  #  ### # # # # ###',
      '#   #  #  # #   ##   # # # #  #  # # # ##   # ',
      '### #  ###  #    ##   #   #   ## # # #  ##  ##'
      ]

      let s = ''
      for (let i = 0; i < t[0].length; i += 2) {
        let row1 = t[0].slice(i, i+2)
        let row2 = t[1].slice(i, i+2)
        let row3 = t[2].slice(i, i+2)
        let row4 = t[3].slice(i, i+2);
        let shift = [row1[0], row2[0], row3[0], row1[1], row2[1], row3[1], row4[0], row4[1]]
          .map(_ => _ == '#')
          .reduce((acc, current, i) => acc + (current ? 2 ** i : 0), 0)
        // U+2800 - U+28FF
        s += String.fromCharCode(0x2800 + shift)
      }
      return s
    }

    console.log(makeFont())
  </script>
</body>
</html>